# NOTE/TODO: origin-discovery doesn't need Origin.js but it shares a
# package.json with the event listener which does

FROM node:10 as build

WORKDIR /app

ENV NODE_ENV=production

# Install lerna
RUN npm i lerna -g --loglevel notice

COPY package-lock.json .
COPY package.json .
COPY lerna.json .
COPY ./origin-js ./origin-js
COPY ./origin-contracts ./origin-contracts
COPY ./origin-discovery ./origin-discovery
COPY ./scripts ./scripts
RUN npm install --loglevel notice --unsafe-perm
RUN lerna run build

WORKDIR /app/origin-discovery

CMD ["npm", "run", "start:discovery"]
